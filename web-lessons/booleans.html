<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Booleans</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
</head>
<body>
    <div class="strikes ml-5 mt-3">
        Strikes:
        <span data-strike="1">‚ùå</span>
        <span data-strike="2">‚ùå</span>
        <span data-strike="3">‚ùå</span>
    </div>
    <div style="background-color: black;">
        <h3 class="text-center pt-3" style="background-color: black; color: white; display: none;"><span style="color: #569CD6;">let</span> <span style="color: #9CDCFE;">fruits</span> = [<span style="color: #CE9178;">"apple"</span>, <span style="color: #CE9178;">"orange"</span>, <span style="color: #CE9178;">"banana"</span>]</h3>
        <h2 class="text-center">Boolean goes here</h2>
    </div>
    <div class="d-flex justify-content-center w-100">
        <button class="btn-attempt" data-value="true">TRUE</button>
        <button class="btn-attempt" data-value="false">FALSE</button>
    </div>
    <div class="d-flex justify-content-center align-items-center w-100 score-box">
        <div class="score-counter mr-3">0</div>
        <div id="emoji">üôÇ</div>
    </div>


    <!-- Modals -->
    <!-- Level up! -->
    <div class="modal fade" id="staticHappy" data-backdrop="static" tabindex="-1" role="dialog"
        aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="staticBackdropLabel">Level up! ü•≥</h5>
                </div>
                <div class="modal-body">
                    Your strikes have been reset! ‚úÖ
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success" data-dismiss="modal">Go! ></button>
                </div>
            </div>
        </div>
    </div>

    <!-- Strike! -->
    <div class="modal fade" id="staticSad" data-backdrop="static" tabindex="-1" role="dialog"
        aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="staticBackdropLabel">Oh no! ü•∫</h5>
                </div>
                <div class="modal-body" id="sad-body">
                    ...
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Keep going ></button>
                </div>
            </div>
        </div>
    </div>

    <!-- Game over -->
    <div class="modal fade" id="staticOver" data-backdrop="static" tabindex="-1" role="dialog"
        aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="staticBackdropLabel">Oh no! ü•∫</h5>
                </div>
                <div class="modal-body" id="over-body" style="font-size: 4rem;">
                    Final score: <span id="final-score" style="color: indianred;"></span>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-warning" data-dismiss="modal">Restart game</button>
                </div>
            </div>
        </div>
    </div>

    <style>
        h2 {
            background-color: black;
            color: white;
            padding: 16px;
            -moz-user-select: none; /* mozilla browsers */
            -khtml-user-select: none; /* webkit browsers */ 
        }

        .btn-attempt {
            width: 200px;
            height: 75px;
            margin: 16px;
            font-size: 2rem;
            color: white;
            border: none;
            border-radius: 5px;
            transition: .2s;
        }

        .btn-attempt:hover {
            transform: scale(1.05);
        }
        
        .btn-attempt:active {
            transform: scale(1);
        }

        [data-value="true"] {
            background-color: green;
        }

        [data-value="false"] {
            background-color: red;
        }

        .score-box {
            font-size: 2.5rem;
        }
        
        .strikes {
            font-size: 3rem;
        }

        .strikes span {
            opacity: .2;
        }

        .boolean {
            color: #569CD6;
        }

    </style>

    <script>
        const randIndex = function (multiplier) {
            return Math.floor(Math.random() * multiplier)
        }

        const randBool = function () {
            const bools = ["true", "false", "!true", "!false"]
            return bools[randIndex(bools.length)]
        }

        const randBoolOp = function () {
            const operators = ["&&", "===", "||", "!=="]
            return operators[randIndex(operators.length)]
        }

        const randNumOp = function () {
            const operators = ["<", ">", ">=", "<=", "===", "!=="]
            return operators[randIndex(operators.length)]
        }

        const randArrayOp = function () {
            const operators = ["===", "!=="];
            return operators[randIndex(operators.length)];
        }

        const fruits = ["apple", "orange", "banana"];
        let arrayText = document.querySelector('h3');

        const randExpression = function (type=3) {
            if (type === 0) {
                return `${randIndex(10)} ${randNumOp()} ${randIndex(10)}`
            } else if (type === 1) {
                return `fruits[${randIndex(fruits.length)}] ${randArrayOp()} "${fruits[randIndex(fruits.length)]}"`
            } else {
                return `${randBool()} ${randBoolOp()} ${randBool()}`
            }
        }

        const randProblem = function (level) {
            if (level === 1) {
                return randBool()
            } else if (level === 2) {
                return randExpression()
            } else if (level === 3) {
                return randExpression(0)
            } else if (level === 5) {
                return `(${randExpression(randIndex(3))}) ${randBoolOp()} (${randExpression(randIndex(3))})`
            } else if (level === 4) {
                arrayText.style.display = 'block'
                return randExpression(1)
            } else if (level === 6) {
                return `((${randExpression(randIndex(3))}) ${randBoolOp()} (${randExpression(randIndex(3))})) ${randBoolOp()} ((${randExpression(randIndex(3))}) ${randBoolOp()} (${randExpression(randIndex(3))}))`
            } else if (level > 6) {
                return `(((${randExpression(randIndex(3))}) ${randBoolOp()} (${randExpression(randIndex(3))})) ${randBoolOp()} ((${randExpression(randIndex(3))}) ${randBoolOp()} (${randExpression(randIndex(3))}))) ${randBoolOp()} (((${randExpression(randIndex(3))}) ${randBoolOp()} (${randExpression(randIndex(3))})) ${randBoolOp()} ((${randExpression(randIndex(3))}) ${randBoolOp()} (${randExpression(randIndex(3))})))`
            }
        }

        let level = 1;

        let problem = document.querySelector('h2');
        let problemRaw = ''
        let scoreCounter = document.querySelector('.score-counter');
        const scoreBox = document.querySelector('.score-box');
        let emoji = document.querySelector('#emoji')
        let strikes = document.querySelector('.strikes')
        let currentStrike = 0

        const increaseScore = function () {
            scoreCounter.innerText = Number(scoreCounter.innerText) + 1;
        }

        const increaseStrikes = function () {
            document.querySelector(`[data-strike="${currentStrike}"`).style.opacity = "1";
        }

        const resetStrikes = function () {
            document.querySelectorAll("[data-strike]").forEach(strike => {
                strike.style.opacity = ".2";
            })
            currentStrike = 0;
        }

        const gameOver = function () {
            document.getElementById('final-score').innerText = scoreCounter.innerText
            $('#staticOver').modal();
            scoreCounter.innerText = '0';
            emoji.innerText = "üôÇ";
            scoreBox.style.fontSize = '2.5rem'
            resetStrikes();
        }

        const resetScore = function () {
            document.querySelector('#sad-body').innerText = `"${problem.innerText}" is ${eval(problemRaw)}`;
            $('#staticSad').modal();
            currentStrike++;
            increaseStrikes();
        }

        const newProblem = function () {
            problemRaw = randProblem(level)
            problem.innerText = problemRaw
            problem.innerHTML = problem.innerHTML.replace(/true/gi, '<span style="color: #569CD6;">true</span>')
            problem.innerHTML = problem.innerHTML.replace(/false/gi, '<span style="color: #569CD6;">false</span>')
            problem.innerHTML = problem.innerHTML.replace(/fruits/gi, '<span style="color: #9CDCFE;">fruits</span>')
            problem.innerHTML = problem.innerHTML.replace(/"apple"/gi, '<span style="color: #CE9178;">"apple"</span>')
            problem.innerHTML = problem.innerHTML.replace(/"orange"/gi, '<span style="color: #CE9178;">"orange"</span>')
            problem.innerHTML = problem.innerHTML.replace(/"banana"/gi, '<span style="color: #CE9178;">"banana"</span>')
        }

        const levelUp = function () {
            level++;
            resetStrikes();
            $('#staticHappy').modal()
            scoreBox.style.fontSize = `${Number(scoreCounter.innerText) / 5 + 2}rem`
            switch (level) {
                case 2:
                    emoji.innerText = 'ü§î'
                    break;
                case 3:
                    emoji.innerText = 'üßê'
                    break;
                case 4:
                    emoji.innerText = 'ü§Ø'
                    break;
                case 5:
                    emoji.innerText = 'ü§¢'
                    break;
                case 6:
                    emoji.innerText = 'ü§Æ'
                    break;
                case 7:
                    emoji.innerText = 'ü§°'
                    break;
                case 8:
                    emoji.innerText = '‚ò†Ô∏è'
                    break;
                case 9:
                    emoji.innerText = 'üëπ'
                    break;
                case 10:
                    emoji.innerText = 'üí©'
                    break;
                case 11:
                    emoji.innerText = 'üëΩüõ∏'
                    break;
            }

        }

        window.onload = newProblem()

        document.querySelectorAll('.btn-attempt').forEach(button => {
            button.onclick = function () {
                if (eval(this.dataset.value) === eval(problemRaw)) {
                    increaseScore()
                    if (Number(scoreCounter.innerText) % 5 === 0) {
                        levelUp()
                    }
                } else if (currentStrike < 2) {
                    resetScore()
                } else {
                    gameOver()
                }
                newProblem()
            }
        })

    </script>


    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
        integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
        integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
        crossorigin="anonymous"></script>
</body>
</html>